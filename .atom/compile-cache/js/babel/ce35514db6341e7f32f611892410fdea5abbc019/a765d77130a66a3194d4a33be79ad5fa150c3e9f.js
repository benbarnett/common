function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _jasmineFix = require('jasmine-fix');

var _libToggleView = require('../lib/toggle-view');

var _libToggleView2 = _interopRequireDefault(_libToggleView);

var _libHelpers = require('../lib/helpers');

describe('Toggle View', function () {
  var oldConfig = undefined;
  (0, _jasmineFix.beforeEach)(_asyncToGenerator(function* () {
    oldConfig = yield (yield (0, _libHelpers.getConfigFile)()).get();
  }));
  (0, _jasmineFix.afterEach)(_asyncToGenerator(function* () {
    yield new Promise(function (resolve) {
      return _fs2['default'].writeFile(_libHelpers.LINTER_CONFIG_FILE_PATH, JSON.stringify(oldConfig, null, 2), resolve);
    });
  }));

  describe('::getItems', function () {
    (0, _jasmineFix.it)('returns disabled when enabling', _asyncToGenerator(function* () {
      var toggleView = new _libToggleView2['default']('enable', ['Package 1', 'Package 2', 'Package 3']);
      var config = yield toggleView.getConfig();
      yield config.set('disabled', ['Package 2']);
      expect((yield toggleView.getItems())).toEqual(['Package 2']);
    }));
    (0, _jasmineFix.it)('returns enabled when disabling', _asyncToGenerator(function* () {
      var toggleView = new _libToggleView2['default']('disable', ['Package 1', 'Package 2', 'Package 3']);
      var config = yield toggleView.getConfig();
      yield config.set('disabled', ['Package 2']);
      expect((yield toggleView.getItems())).toEqual(['Package 1', 'Package 3']);
    }));
  });
  (0, _jasmineFix.it)('has a working lifecycle', _asyncToGenerator(function* () {
    var didDisable = [];
    var toggleView = new _libToggleView2['default']('disable', ['Package 1', 'Package 2', 'Package 3']);
    var config = yield toggleView.getConfig();

    spyOn(toggleView, 'process').andCallThrough();
    spyOn(toggleView, 'getItems').andCallThrough();
    toggleView.onDidDisable(function (name) {
      return didDisable.push(name);
    });

    expect(didDisable).toEqual([]);
    expect(toggleView.process.calls.length).toBe(0);
    expect(toggleView.getItems.calls.length).toBe(0);
    expect(atom.workspace.getModalPanels().length).toBe(0);
    yield toggleView.show();
    expect(didDisable).toEqual([]);
    expect(toggleView.process.calls.length).toBe(0);
    expect(toggleView.getItems.calls.length).toBe(1);
    expect(atom.workspace.getModalPanels().length).toBe(1);

    var element = atom.workspace.getModalPanels()[0].item.element.querySelector('.list-group');
    expect(element.children.length).toBe(3);
    expect(element.children[0].textContent).toBe('Package 1');
    expect(element.children[1].textContent).toBe('Package 2');
    expect(element.children[2].textContent).toBe('Package 3');
    element.children[1].dispatchEvent(new MouseEvent('click'));

    expect(toggleView.process.calls.length).toBe(1);
    expect(toggleView.getItems.calls.length).toBe(1);
    expect(toggleView.process.calls[0].args[0]).toBe('Package 2');
    yield (0, _jasmineFix.wait)(50);
    expect(didDisable).toEqual(['Package 2']);
    expect((yield config.get('disabled'))).toEqual(['Package 2']);
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9iZW5iYXJuZXR0Ly5hdG9tL3BhY2thZ2VzL2xpbnRlci9zcGVjL3RvZ2dsZS12aWV3LXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztrQkFFZSxJQUFJOzs7OzBCQUM2QixhQUFhOzs2QkFFdEMsb0JBQW9COzs7OzBCQUNZLGdCQUFnQjs7QUFFdkUsUUFBUSxDQUFDLGFBQWEsRUFBRSxZQUFXO0FBQ2pDLE1BQUksU0FBUyxZQUFBLENBQUE7QUFDYixnREFBVyxhQUFpQjtBQUMxQixhQUFTLEdBQUcsTUFBTSxDQUFDLE1BQU0sZ0NBQWUsQ0FBQSxDQUFFLEdBQUcsRUFBRSxDQUFBO0dBQ2hELEVBQUMsQ0FBQTtBQUNGLCtDQUFVLGFBQWlCO0FBQ3pCLFVBQU0sSUFBSSxPQUFPLENBQUMsVUFBQSxPQUFPO2FBQUksZ0JBQUcsU0FBUyxzQ0FBMEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQztLQUFBLENBQUMsQ0FBQTtHQUNqSCxFQUFDLENBQUE7O0FBRUYsVUFBUSxDQUFDLFlBQVksRUFBRSxZQUFXO0FBQ2hDLHdCQUFHLGdDQUFnQyxvQkFBRSxhQUFpQjtBQUNwRCxVQUFNLFVBQVUsR0FBRywrQkFBZSxRQUFRLEVBQUUsQ0FBQyxXQUFXLEVBQUUsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUE7QUFDcEYsVUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUE7QUFDM0MsWUFBTSxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUE7QUFDM0MsWUFBTSxFQUFDLE1BQU0sVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFBO0tBQzNELEVBQUMsQ0FBQTtBQUNGLHdCQUFHLGdDQUFnQyxvQkFBRSxhQUFpQjtB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QUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0FBQ3pELFdBQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUE7O0FBRTFELFVBQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDL0MsVUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUNoRCxVQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0FBQzdELFVBQU0sc0JBQUssRUFBRSxDQUFDLENBQUE7QUFDZCxVQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQTtBQUN6QyxVQUFNLEVBQUMsTUFBTSxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFBO0dBQzVELEVBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvVXNlcnMvYmVuYmFybmV0dC8uYXRvbS9wYWNrYWdlcy9saW50ZXIvc3BlYy90b2dnbGUtdmlldy1zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogQGZsb3cgKi9cblxuaW1wb3J0IEZTIGZyb20gJ2ZzJ1xuaW1wb3J0IHsgaXQsIHdhaXQsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ2phc21pbmUtZml4J1xuXG5pbXBvcnQgVG9nZ2xlVmlldyBmcm9tICcuLi9saWIvdG9nZ2xlLXZpZXcnXG5pbXBvcnQgeyBMSU5URVJfQ09ORklHX0ZJTEVfUEFUSCwgZ2V0Q29uZmlnRmlsZSB9IGZyb20gJy4uL2xpYi9oZWxwZXJzJ1xuXG5kZXNjcmliZSgnVG9nZ2xlIFZpZXcnLCBmdW5jdGlvbigpIHtcbiAgbGV0IG9sZENvbmZpZ1xuICBiZWZvcmVFYWNoKGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgIG9sZENvbmZpZyA9IGF3YWl0IChhd2FpdCBnZXRDb25maWdGaWxlKCkpLmdldCgpXG4gIH0pXG4gIGFmdGVyRWFjaChhc3luYyBmdW5jdGlvbigpIHtcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IEZTLndyaXRlRmlsZShMSU5URVJfQ09ORklHX0ZJTEVfUEFUSCwgSlNPTi5zdHJpbmdpZnkob2xkQ29uZmlnLCBudWxsLCAyKSwgcmVzb2x2ZSkpXG4gIH0pXG5cbiAgZGVzY3JpYmUoJzo6Z2V0SXRlbXMnLCBmdW5jdGlvbigpIHtcbiAgICBpdCgncmV0dXJucyBkaXNhYmxlZCB3aGVuIGVuYWJsaW5nJywgYXN5bmMgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCB0b2dnbGVWaWV3ID0gbmV3IFRvZ2dsZVZpZXcoJ2VuYWJsZScsIFsnUGFja2FnZSAxJywgJ1BhY2thZ2UgMicsICdQYWNrYWdlIDMnXSlcbiAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHRvZ2dsZVZpZXcuZ2V0Q29uZmlnKClcbiAgICAgIGF3YWl0IGNvbmZpZy5zZXQoJ2Rpc2FibGVkJywgWydQYWNrYWdlIDInXSlcbiAgICAgIGV4cGVjdChhd2FpdCB0b2dnbGVWaWV3LmdldEl0ZW1zKCkpLnRvRXF1YWwoWydQYWNrYWdlIDInXSlcbiAgICB9KVxuICAgIGl0KCdyZXR1cm5zIGVuYWJsZWQgd2hlbiBkaXNhYmxpbmcnLCBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAgIGNvbnN0IHRvZ2dsZVZpZXcgPSBuZXcgVG9nZ2xlVmlldygnZGlzYWJsZScsIFsnUGFja2FnZSAxJywgJ1BhY2thZ2UgMicsICdQYWNrYWdlIDMnXSlcbiAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHRvZ2dsZVZpZXcuZ2V0Q29uZmlnKClcbiAgICAgIGF3YWl0IGNvbmZpZy5zZXQoJ2Rpc2FibGVkJywgWydQYWNrYWdlIDInXSlcbiAgICAgIGV4cGVjdChhd2FpdCB0b2dnbGVWaWV3LmdldEl0ZW1zKCkpLnRvRXF1YWwoWydQYWNrYWdlIDEnLCAnUGFja2FnZSAzJ10pXG4gICAgfSlcbiAgfSlcbiAgaXQoJ2hhcyBhIHdvcmtpbmcgbGlmZWN5Y2xlJywgYXN5bmMgZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgZGlkRGlzYWJsZSA9IFtdXG4gICAgY29uc3QgdG9nZ2xlVmlldyA9IG5ldyBUb2dnbGVWaWV3KCdkaXNhYmxlJywgWydQYWNrYWdlIDEnLCAnUGFja2FnZSAyJywgJ1BhY2thZ2UgMyddKVxuICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHRvZ2dsZVZpZXcuZ2V0Q29uZmlnKClcblxuICAgIHNweU9uKHRvZ2dsZVZpZXcsICdwcm9jZXNzJykuYW5kQ2FsbFRocm91Z2goKVxuICAgIHNweU9uKHRvZ2dsZVZpZXcsICdnZXRJdGVtcycpLmFuZENhbGxUaHJvdWdoKClcbiAgICB0b2dnbGVWaWV3Lm9uRGlkRGlzYWJsZShuYW1lID0+IGRpZERpc2FibGUucHVzaChuYW1lKSlcblxuICAgIGV4cGVjdChkaWREaXNhYmxlKS50b0VxdWFsKFtdKVxuICAgIGV4cGVjdCh0b2dnbGVWaWV3LnByb2Nlc3MuY2FsbHMubGVuZ3RoKS50b0JlKDApXG4gICAgZXhwZWN0KHRvZ2dsZVZpZXcuZ2V0SXRlbXMuY2FsbHMubGVuZ3RoKS50b0JlKDApXG4gICAgZXhwZWN0KGF0b20ud29ya3NwYWNlLmdldE1vZGFsUGFuZWxzKCkubGVuZ3RoKS50b0JlKDApXG4gICAgYXdhaXQgdG9nZ2xlVmlldy5zaG93KClcbiAgICBleHBlY3QoZGlkRGlzYWJsZSkudG9FcXVhbChbXSlcbiAgICBleHBlY3QodG9nZ2xlVmlldy5wcm9jZXNzLmNhbGxzLmxlbmd0aCkudG9CZSgwKVxuICAgIGV4cGVjdCh0b2dnbGVWaWV3LmdldEl0ZW1zLmNhbGxzLmxlbmd0aCkudG9CZSgxKVxuICAgIGV4cGVjdChhdG9tLndvcmtzcGFjZS5nZXRNb2RhbFBhbmVscygpLmxlbmd0aCkudG9CZSgxKVxuXG4gICAgY29uc3QgZWxlbWVudCA9IGF0b20ud29ya3NwYWNlLmdldE1vZGFsUGFuZWxzKClbMF0uaXRlbS5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0LWdyb3VwJylcbiAgICBleHBlY3QoZWxlbWVudC5jaGlsZHJlbi5sZW5ndGgpLnRvQmUoMylcbiAgICBleHBlY3QoZWxlbWVudC5jaGlsZHJlblswXS50ZXh0Q29udGVudCkudG9CZSgnUGFja2FnZSAxJylcbiAgICBleHBlY3QoZWxlbWVudC5jaGlsZHJlblsxXS50ZXh0Q29udGVudCkudG9CZSgnUGFja2FnZSAyJylcbiAgICBleHBlY3QoZWxlbWVudC5jaGlsZHJlblsyXS50ZXh0Q29udGVudCkudG9CZSgnUGFja2FnZSAzJylcbiAgICBlbGVtZW50LmNoaWxkcmVuWzFdLmRpc3BhdGNoRXZlbnQobmV3IE1vdXNlRXZlbnQoJ2NsaWNrJykpXG5cbiAgICBleHBlY3QodG9nZ2xlVmlldy5wcm9jZXNzLmNhbGxzLmxlbmd0aCkudG9CZSgxKVxuICAgIGV4cGVjdCh0b2dnbGVWaWV3LmdldEl0ZW1zLmNhbGxzLmxlbmd0aCkudG9CZSgxKVxuICAgIGV4cGVjdCh0b2dnbGVWaWV3LnByb2Nlc3MuY2FsbHNbMF0uYXJnc1swXSkudG9CZSgnUGFja2FnZSAyJylcbiAgICBhd2FpdCB3YWl0KDUwKVxuICAgIGV4cGVjdChkaWREaXNhYmxlKS50b0VxdWFsKFsnUGFja2FnZSAyJ10pXG4gICAgZXhwZWN0KGF3YWl0IGNvbmZpZy5nZXQoJ2Rpc2FibGVkJykpLnRvRXF1YWwoWydQYWNrYWdlIDInXSlcbiAgfSlcbn0pXG4iXX0=