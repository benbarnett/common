function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _libIndieDelegate = require('../lib/indie-delegate');

var _libIndieDelegate2 = _interopRequireDefault(_libIndieDelegate);

var _common = require('./common');

describe('IndieDelegate', function () {
  var indieDelegate = undefined;

  beforeEach(function () {
    indieDelegate = new _libIndieDelegate2['default']({
      name: 'Indie'
    });
  });
  afterEach(function () {
    indieDelegate.dispose();
  });

  it('has the basic linter properties', function () {
    expect(typeof indieDelegate.name).toBe('string');
    expect(indieDelegate.name).toBe('Indie');
    expect(typeof indieDelegate.scope).toBe('string');
    expect(indieDelegate.scope).toBe('project');
  });
  describe('::normalizeMessages', function () {
    it('returns true if messages are valid', function () {
      expect(_libIndieDelegate2['default'].normalizeMessages(indieDelegate.name, [(0, _common.getMessage)(false)])).toBe(true);
    });
    it('returns false if messages are invalid', function () {
      // $FlowIgnore: Invalid message type on purpose
      expect(_libIndieDelegate2['default'].normalizeMessages(indieDelegate.name, [{}])).toBe(false);
    });
    it('only normalizes when messages are valid', function () {
      {
        // scenario: valid
        var message = (0, _common.getMessage)(false);
        expect(message.location.position.constructor.name).toBe('Array');
        expect(_libIndieDelegate2['default'].normalizeMessages(indieDelegate.name, [message])).toBe(true);
        expect(message.location.position.constructor.name).toBe('Range');
        expect(message.version).toBe(2);
      }
      {
        // scenario: invalid
        var message = {};
        expect(message.version).not.toBeDefined();
        expect(_libIndieDelegate2['default'].normalizeMessages(indieDelegate.name, [message])).toBe(false);
        expect(message.version).not.toBeDefined();
      }
    });
  });
  describe('::setMessages && ::getMessages && ::clearMessages', function () {
    it('works as expected', function () {
      var message = (0, _common.getMessage)();
      expect(indieDelegate.getMessages()).toEqual([]);
      indieDelegate.setMessages(message.location.file, [message]);
      expect(indieDelegate.getMessages()).toEqual([message]);
      indieDelegate.clearMessages();
      expect(indieDelegate.getMessages()).toEqual([]);
    });
  });
  describe('::setMessages', function () {
    it('overwrites previous messages for that file', function () {
      var messageA = (0, _common.getMessage)();
      var messageB = (0, _common.getMessage)();
      var messageC = (0, _common.getMessage)();
      expect(indieDelegate.getMessages()).toEqual([]);
      indieDelegate.setMessages(messageA.location.file, [messageA, messageB]);
      expect(indieDelegate.getMessages()).toEqual([messageA, messageB]);
      indieDelegate.setMessages(messageA.location.file, [messageA, messageC]);
      expect(indieDelegate.getMessages()).toEqual([messageA, messageC]);
      indieDelegate.setMessages(messageA.location.file, [messageB, messageC]);
      expect(indieDelegate.getMessages()).toEqual([messageB, messageC]);
      indieDelegate.setMessages(messageA.location.file, [messageC]);
      expect(indieDelegate.getMessages()).toEqual([messageC]);
      indieDelegate.setMessages(messageA.location.file, []);
      expect(indieDelegate.getMessages()).toEqual([]);
    });
    it('does not update if is disposed', function () {
      var timesUpdated = 0;
      indieDelegate.onDidUpdate(function () {
        timesUpdated++;
      });
      expect(timesUpdated).toBe(0);
      indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename)]);
      expect(timesUpdated).toBe(1);
      indieDelegate.dispose();
      indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename)]);
      expect(timesUpdated).toBe(1);
    });
    it('does update if not disposed', function () {
      var timesUpdated = 0;
      indieDelegate.onDidUpdate(function () {
        timesUpdated++;
      });
      expect(timesUpdated).toBe(0);
      indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename)]);
      expect(timesUpdated).toBe(1);
      indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename)]);
      expect(timesUpdated).toBe(2);
    });
    it('cries if message has a different filePath', function () {
      expect(function () {
        indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename)]);
      }).not.toThrow();
      expect(function () {
        indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename), (0, _common.getMessage)(__filename), (0, _common.getMessage)(__filename)]);
      }).not.toThrow();
      expect(function () {
        indieDelegate.setMessages(__filename, [(0, _common.getMessage)()]);
      }).toThrow('messages[0].location.file does not match the given filePath');
      expect(function () {
        indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename), (0, _common.getMessage)()]);
      }).toThrow('messages[1].location.file does not match the given filePath');
      expect(function () {
        indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename), (0, _common.getMessage)(), (0, _common.getMessage)(__filename)]);
      }).toThrow('messages[1].location.file does not match the given filePath');
      expect(function () {
        indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename), (0, _common.getMessage)(__filename), (0, _common.getMessage)()]);
      }).toThrow('messages[2].location.file does not match the given filePath');
    });
  });
  describe('::clearMessages', function () {
    it('does not update if disposed', function () {
      var timesUpdated = 0;
      indieDelegate.onDidUpdate(function () {
        timesUpdated++;
      });
      expect(timesUpdated).toBe(0);
      indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename)]);
      expect(timesUpdated).toBe(1);
      indieDelegate.dispose();
      indieDelegate.clearMessages();
      expect(timesUpdated).toBe(1);
    });
    it('does update if not disposed', function () {
      var timesUpdated = 0;
      indieDelegate.onDidUpdate(function () {
        timesUpdated++;
      });
      expect(timesUpdated).toBe(0);
      indieDelegate.setMessages(__filename, [(0, _common.getMessage)(__filename)]);
      expect(timesUpdated).toBe(1);
      indieDelegate.clearMessages();
      expect(timesUpdated).toBe(2);
    });
  });
  describe('::setAllMessages', function () {
    it('automatically splits messages into filePath groups', function () {
      var messageA = (0, _common.getMessage)();
      var messageB = (0, _common.getMessage)();
      var messageC = (0, _common.getMessage)();
      var messageD = (0, _common.getMessage)();

      messageC.location.file = messageD.location.file = __filename;
      expect(indieDelegate.messages.size).toBe(0);
      indieDelegate.setAllMessages([messageA, messageB, messageC, messageD]);
      expect(indieDelegate.messages.size).toBe(2);

      var messagesA = indieDelegate.messages.get(messageA.location.file);
      expect(Array.isArray(messagesA)).toBe(true);
      expect(messagesA).toEqual([messageA, messageB]);

      var messagesB = indieDelegate.messages.get(messageC.location.file);
      expect(Array.isArray(messagesB)).toBe(true);
      expect(messagesB).toEqual([messageC, messageD]);
    });
    it('does not update if disposed', function () {
      var timesUpdated = 0;
      indieDelegate.onDidUpdate(function () {
        timesUpdated++;
      });
      expect(timesUpdated).toBe(0);
      indieDelegate.setAllMessages([(0, _common.getMessage)()]);
      expect(timesUpdated).toBe(1);
      indieDelegate.dispose();
      indieDelegate.setAllMessages([]);
      expect(timesUpdated).toBe(1);
    });
    it('does update if not disposed', function () {
      var timesUpdated = 0;
      indieDelegate.onDidUpdate(function () {
        timesUpdated++;
      });
      expect(timesUpdated).toBe(0);
      indieDelegate.setAllMessages([(0, _common.getMessage)()]);
      expect(timesUpdated).toBe(1);
      indieDelegate.setAllMessages([]);
      expect(timesUpdated).toBe(2);
    });
  });
  describe('::dispose', function () {
    it('clears messages', function () {
      indieDelegate.setAllMessages([(0, _common.getMessage)()]);
      expect(indieDelegate.messages.size).toBe(1);
      indieDelegate.dispose();
      expect(indieDelegate.messages.size).toBe(0);
    });
    it('emits did-destroy event', function () {
      var didDestroy = false;
      indieDelegate.onDidDestroy(function () {
        didDestroy = true;
      });
      expect(didDestroy).toBe(false);
      indieDelegate.dispose();
      expect(didDestroy).toBe(true);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9iZW5iYXJuZXR0Ly5hdG9tL3BhY2thZ2VzL2xpbnRlci9zcGVjL2luZGllLWRlbGVnYXRlLXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Z0NBRTBCLHVCQUF1Qjs7OztzQkFDdEIsVUFBVTs7QUFFckMsUUFBUSxDQUFDLGVBQWUsRUFBRSxZQUFXO0FBQ25DLE1BQUksYUFBYSxZQUFBLENBQUE7O0FBRWpCLFlBQVUsQ0FBQyxZQUFXO0FBQ3BCLGlCQUFhLEdBQUcsa0NBQWtCO0FBQ2hDLFVBQUksRUFBRSxPQUFPO0tBQ2QsQ0FBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBO0FBQ0YsV0FBUyxDQUFDLFlBQVc7QUFDbkIsaUJBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtHQUN4QixDQUFDLENBQUE7O0FBRUYsSUFBRSxDQUFDLGlDQUFpQyxFQUFFLFlBQVc7QUFDL0MsVUFBTSxDQUFDLE9BQU8sYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtBQUNoRCxVQUFNLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUN4QyxVQUFNLENBQUMsT0FBTyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQ2pELFVBQU0sQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFBO0dBQzVDLENBQUMsQ0FBQTtBQUNGLFVBQVEsQ0FBQyxxQkFBcUIsRUFBRSxZQUFXO0FBQ3pDLE1BQUUsQ0FBQyxvQ0FBb0MsRUFBRSxZQUFXO0FBQ2xELFlBQU0sQ0FBQyw4QkFBYyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUMsd0JBQVcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0tBQzVGLENBQUMsQ0FBQTtBQUNG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QUMsQ0FBQTtHQUNILENBQUMsQ0FBQTtBQUNGLFVBQVEsQ0FBQyxXQUFXLEVBQUUsWUFBVztBQUMvQixNQUFFLENBQUMsaUJBQWlCLEVBQUUsWUFBVztBQUMvQixtQkFBYSxDQUFDLGNBQWMsQ0FBQyxDQUFDLHlCQUFZLENBQUMsQ0FBQyxDQUFBO0FBQzVDLFlBQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUMzQyxtQkFBYSxDQUFDLE9BQU8sRUFBRSxDQUFBO0FBQ3ZCLFlBQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtLQUM1QyxDQUFDLENBQUE7QUFDRixNQUFFLENBQUMseUJBQXlCLEVBQUUsWUFBVztBQUN2QyxVQUFJLFVBQVUsR0FBRyxLQUFLLENBQUE7QUFDdEIsbUJBQWEsQ0FBQyxZQUFZLENBQUMsWUFBVztBQUNwQyxrQkFBVSxHQUFHLElBQUksQ0FBQTtPQUNsQixDQUFDLENBQUE7QUFDRixZQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQzlCLG1CQUFhLENBQUMsT0FBTyxFQUFFLENBQUE7QUFDdkIsWUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtLQUM5QixDQUFDLENBQUE7R0FDSCxDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUEiLCJmaWxlIjoiL1VzZXJzL2JlbmJhcm5ldHQvLmF0b20vcGFja2FnZXMvbGludGVyL3NwZWMvaW5kaWUtZGVsZWdhdGUtc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIEBmbG93ICovXG5cbmltcG9ydCBJbmRpZURlbGVnYXRlIGZyb20gJy4uL2xpYi9pbmRpZS1kZWxlZ2F0ZSdcbmltcG9ydCB7IGdldE1lc3NhZ2UgfSBmcm9tICcuL2NvbW1vbidcblxuZGVzY3JpYmUoJ0luZGllRGVsZWdhdGUnLCBmdW5jdGlvbigpIHtcbiAgbGV0IGluZGllRGVsZWdhdGVcblxuICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkge1xuICAgIGluZGllRGVsZWdhdGUgPSBuZXcgSW5kaWVEZWxlZ2F0ZSh7XG4gICAgICBuYW1lOiAnSW5kaWUnLFxuICAgIH0pXG4gIH0pXG4gIGFmdGVyRWFjaChmdW5jdGlvbigpIHtcbiAgICBpbmRpZURlbGVnYXRlLmRpc3Bvc2UoKVxuICB9KVxuXG4gIGl0KCdoYXMgdGhlIGJhc2ljIGxpbnRlciBwcm9wZXJ0aWVzJywgZnVuY3Rpb24oKSB7XG4gICAgZXhwZWN0KHR5cGVvZiBpbmRpZURlbGVnYXRlLm5hbWUpLnRvQmUoJ3N0cmluZycpXG4gICAgZXhwZWN0KGluZGllRGVsZWdhdGUubmFtZSkudG9CZSgnSW5kaWUnKVxuICAgIGV4cGVjdCh0eXBlb2YgaW5kaWVEZWxlZ2F0ZS5zY29wZSkudG9CZSgnc3RyaW5nJylcbiAgICBleHBlY3QoaW5kaWVEZWxlZ2F0ZS5zY29wZSkudG9CZSgncHJvamVjdCcpXG4gIH0pXG4gIGRlc2NyaWJlKCc6Om5vcm1hbGl6ZU1lc3NhZ2VzJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiBtZXNzYWdlcyBhcmUgdmFsaWQnLCBmdW5jdGlvbigpIHtcbiAgICAgIGV4cGVjdChJbmRpZURlbGVnYXRlLm5vcm1hbGl6ZU1lc3NhZ2VzKGluZGllRGVsZWdhdGUubmFtZSwgW2dldE1lc3NhZ2UoZmFsc2UpXSkpLnRvQmUodHJ1ZSlcbiAgICB9KVxuICAgIGl0KCdyZXR1cm5zIGZhbHNlIGlmIG1lc3NhZ2VzIGFyZSBpbnZhbGlkJywgZnVuY3Rpb24oKSB7XG4gICAgICAvLyAkRmxvd0lnbm9yZTogSW52YWxpZCBtZXNzYWdlIHR5cGUgb24gcHVycG9zZVxuICAgICAgZXhwZWN0KEluZGllRGVsZWdhdGUubm9ybWFsaXplTWVzc2FnZXMoaW5kaWVEZWxlZ2F0ZS5uYW1lLCBbe31dKSkudG9CZShmYWxzZSlcbiAgICB9KVxuICAgIGl0KCdvbmx5IG5vcm1hbGl6ZXMgd2hlbiBtZXNzYWdlcyBhcmUgdmFsaWQnLCBmdW5jdGlvbigpIHtcbiAgICAgIHtcbiAgICAgICAgLy8gc2NlbmFyaW86IHZhbGlkXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRNZXNzYWdlKGZhbHNlKVxuICAgICAgICBleHBlY3QobWVzc2FnZS5sb2NhdGlvbi5wb3NpdGlvbi5jb25zdHJ1Y3Rvci5uYW1lKS50b0JlKCdBcnJheScpXG4gICAgICAgIGV4cGVjdChJbmRpZURlbGVnYXRlLm5vcm1hbGl6ZU1lc3NhZ2VzKGluZGllRGVsZWdhdGUubmFtZSwgW21lc3NhZ2VdKSkudG9CZSh0cnVlKVxuICAgICAgICBleHBlY3QobWVzc2FnZS5sb2NhdGlvbi5wb3NpdGlvbi5jb25zdHJ1Y3Rvci5uYW1lKS50b0JlKCdSYW5nZScpXG4gICAgICAgIGV4cGVjdChtZXNzYWdlLnZlcnNpb24pLnRvQmUoMilcbiAgICAgIH1cbiAgICAgIHtcbiAgICAgICAgLy8gc2NlbmFyaW86IGludmFsaWRcbiAgICAgICAgY29uc3QgbWVzc2FnZTogT2JqZWN0ID0geyB9XG4gICAgICAgIGV4cGVjdChtZXNzYWdlLnZlcnNpb24pLm5vdC50b0JlRGVmaW5lZCgpXG4gICAgICAgIGV4cGVjdChJbmRpZURlbGVnYXRlLm5vcm1hbGl6ZU1lc3NhZ2VzKGluZGllRGVsZWdhdGUubmFtZSwgW21lc3NhZ2VdKSkudG9CZShmYWxzZSlcbiAgICAgICAgZXhwZWN0KG1lc3NhZ2UudmVyc2lvbikubm90LnRvQmVEZWZpbmVkKClcbiAgICAgIH1cbiAgICB9KVxuICB9KVxuICBkZXNjcmliZSgnOjpzZXRNZXNzYWdlcyAmJiA6OmdldE1lc3NhZ2VzICYmIDo6Y2xlYXJNZXNzYWdlcycsIGZ1bmN0aW9uKCkge1xuICAgIGl0KCd3b3JrcyBhcyBleHBlY3RlZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IGdldE1lc3NhZ2UoKVxuICAgICAgZXhwZWN0KGluZGllRGVsZWdhdGUuZ2V0TWVzc2FnZXMoKSkudG9FcXVhbChbXSlcbiAgICAgIGluZGllRGVsZWdhdGUuc2V0TWVzc2FnZXMobWVzc2FnZS5sb2NhdGlvbi5maWxlLCBbbWVzc2FnZV0pXG4gICAgICBleHBlY3QoaW5kaWVEZWxlZ2F0ZS5nZXRNZXNzYWdlcygpKS50b0VxdWFsKFttZXNzYWdlXSlcbiAgICAgIGluZGllRGVsZWdhdGUuY2xlYXJNZXNzYWdlcygpXG4gICAgICBleHBlY3QoaW5kaWVEZWxlZ2F0ZS5nZXRNZXNzYWdlcygpKS50b0VxdWFsKFtdKVxuICAgIH0pXG4gIH0pXG4gIGRlc2NyaWJlKCc6OnNldE1lc3NhZ2VzJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ292ZXJ3cml0ZXMgcHJldmlvdXMgbWVzc2FnZXMgZm9yIHRoYXQgZmlsZScsIGZ1bmN0aW9uKCkge1xuICAgICAgY29uc3QgbWVzc2FnZUEgPSBnZXRNZXNzYWdlKClcbiAgICAgIGNvbnN0IG1lc3NhZ2VCID0gZ2V0TWVzc2FnZSgpXG4gICAgICBjb25zdCBtZXNzYWdlQyA9IGdldE1lc3NhZ2UoKVxuICAgICAgZXhwZWN0KGluZGllRGVsZWdhdGUuZ2V0TWVzc2FnZXMoKSkudG9FcXVhbChbXSlcbiAgICAgIGluZGllRGVsZWdhdGUuc2V0TWVzc2FnZXMobWVzc2FnZUEubG9jYXRpb24uZmlsZSwgW21lc3NhZ2VBLCBtZXNzYWdlQl0pXG4gICAgICBleHBlY3QoaW5kaWVEZWxlZ2F0ZS5nZXRNZXNzYWdlcygpKS50b0VxdWFsKFttZXNzYWdlQSwgbWVzc2FnZUJdKVxuICAgICAgaW5kaWVEZWxlZ2F0ZS5zZXRNZXNzYWdlcyhtZXNzYWdlQS5sb2NhdGlvbi5maWxlLCBbbWVzc2FnZUEsIG1lc3NhZ2VDXSlcbiAgICAgIGV4cGVjdChpbmRpZURlbGVnYXRlLmdldE1lc3NhZ2VzKCkpLnRvRXF1YWwoW21lc3NhZ2VBLCBtZXNzYWdlQ10pXG4gICAgICBpbmRpZURlbGVnYXRlLnNldE1lc3NhZ2VzKG1lc3NhZ2VBLmxvY2F0aW9uLmZpbGUsIFttZXNzYWdlQiwgbWVzc2FnZUNdKVxuICAgICAgZXhwZWN0KGluZGllRGVsZWdhdGUuZ2V0TWVzc2FnZXMoKSkudG9FcXVhbChbbWVzc2FnZUIsIG1lc3NhZ2VDXSlcbiAgICAgIGluZGllRGVsZWdhdGUuc2V0TWVzc2FnZXMobWVzc2FnZUEubG9jYXRpb24uZmlsZSwgW21lc3NhZ2VDXSlcbiAgICAgIGV4cGVjdChpbmRpZURlbGVnYXRlLmdldE1lc3NhZ2VzKCkpLnRvRXF1YWwoW21lc3NhZ2VDXSlcbiAgICAgIGluZGllRGVsZWdhdGUuc2V0TWVzc2FnZXMobWVzc2FnZUEubG9jYXRpb24uZmlsZSwgW10pXG4gICAgICBleHBlY3QoaW5kaWVEZWxlZ2F0ZS5nZXRNZXNzYWdlcygpKS50b0VxdWFsKFtdKVxuICAgIH0pXG4gICAgaXQoJ2RvZXMgbm90IHVwZGF0ZSBpZiBpcyBkaXNwb3NlZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgbGV0IHRpbWVzVXBkYXRlZCA9IDBcbiAgICAgIGluZGllRGVsZWdhdGUub25EaWRVcGRhdGUoZnVuY3Rpb24oKSB7XG4gICAgICAgIHRpbWVzVXBkYXRlZCsrXG4gICAgICB9KVxuICAgICAgZXhwZWN0KHRpbWVzVXBkYXRlZCkudG9CZSgwKVxuICAgICAgaW5kaWVEZWxlZ2F0ZS5zZXRNZXNzYWdlcyhfX2ZpbGVuYW1lLCBbZ2V0TWVzc2FnZShfX2ZpbGVuYW1lKV0pXG4gICAgICBleHBlY3QodGltZXNVcGRhdGVkKS50b0JlKDEpXG4gICAgICBpbmRpZURlbGVnYXRlLmRpc3Bvc2UoKVxuICAgICAgaW5kaWVEZWxlZ2F0ZS5zZXRNZXNzYWdlcyhfX2ZpbGVuYW1lLCBbZ2V0TWVzc2FnZShfX2ZpbGVuYW1lKV0pXG4gICAgICBleHBlY3QodGltZXNVcGRhdGVkKS50b0JlKDEpXG4gICAgfSlcbiAgICBpdCgnZG9lcyB1cGRhdGUgaWYgbm90IGRpc3Bvc2VkJywgZnVuY3Rpb24oKSB7XG4gICAgICBsZXQgdGltZXNVcGRhdGVkID0gMFxuICAgICAgaW5kaWVEZWxlZ2F0ZS5vbkRpZFVwZGF0ZShmdW5jdGlvbigpIHtcbiAgICAgICAgdGltZXNVcGRhdGVkKytcbiAgICAgIH0pXG4gICAgICBleHBlY3QodGltZXNVcGRhdGVkKS50b0JlKDApXG4gICAgICBpbmRpZURlbGVnYXRlLnNldE1lc3NhZ2VzKF9fZmlsZW5hbWUsIFtnZXRNZXNzYWdlKF9fZmlsZW5hbWUpXSlcbiAgICAgIGV4cGVjdCh0aW1lc1VwZGF0ZWQpLnRvQmUoMSlcbiAgICAgIGluZGllRGVsZWdhdGUuc2V0TWVzc2FnZXMoX19maWxlbmFtZSwgW2dldE1lc3NhZ2UoX19maWxlbmFtZSldKVxuICAgICAgZXhwZWN0KHRpbWVzVXBkYXRlZCkudG9CZSgyKVxuICAgIH0pXG4gICAgaXQoJ2NyaWVzIGlmIG1lc3NhZ2UgaGFzIGEgZGlmZmVyZW50IGZpbGVQYXRoJywgZnVuY3Rpb24oKSB7XG4gICAgICBleHBlY3QoZnVuY3Rpb24oKSB7XG4gICAgICAgIGluZGllRGVsZWdhdGUuc2V0TWVzc2FnZXMoX19maWxlbmFtZSwgW2dldE1lc3NhZ2UoX19maWxlbmFtZSldKVxuICAgICAgfSkubm90LnRvVGhyb3coKVxuICAgICAgZXhwZWN0KGZ1bmN0aW9uKCkge1xuICAgICAgICBpbmRpZURlbGVnYXRlLnNldE1lc3NhZ2VzKF9fZmlsZW5hbWUsIFtnZXRNZXNzYWdlKF9fZmlsZW5hbWUpLCBnZXRNZXNzYWdlKF9fZmlsZW5hbWUpLCBnZXRNZXNzYWdlKF9fZmlsZW5hbWUpXSlcbiAgICAgIH0pLm5vdC50b1Rocm93KClcbiAgICAgIGV4cGVjdChmdW5jdGlvbigpIHtcbiAgICAgICAgaW5kaWVEZWxlZ2F0ZS5zZXRNZXNzYWdlcyhfX2ZpbGVuYW1lLCBbZ2V0TWVzc2FnZSgpXSlcbiAgICAgIH0pLnRvVGhyb3coJ21lc3NhZ2VzWzBdLmxvY2F0aW9uLmZpbGUgZG9lcyBub3QgbWF0Y2ggdGhlIGdpdmVuIGZpbGVQYXRoJylcbiAgICAgIGV4cGVjdChmdW5jdGlvbigpIHtcbiAgICAgICAgaW5kaWVEZWxlZ2F0ZS5zZXRNZXNzYWdlcyhfX2ZpbGVuYW1lLCBbZ2V0TWVzc2FnZShfX2ZpbGVuYW1lKSwgZ2V0TWVzc2FnZSgpXSlcbiAgICAgIH0pLnRvVGhyb3coJ21lc3NhZ2VzWzFdLmxvY2F0aW9uLmZpbGUgZG9lcyBub3QgbWF0Y2ggdGhlIGdpdmVuIGZpbGVQYXRoJylcbiAgICAgIGV4cGVjdChmdW5jdGlvbigpIHtcbiAgICAgICAgaW5kaWVEZWxlZ2F0ZS5zZXRNZXNzYWdlcyhfX2ZpbGVuYW1lLCBbZ2V0TWVzc2FnZShfX2ZpbGVuYW1lKSwgZ2V0TWVzc2FnZSgpLCBnZXRNZXNzYWdlKF9fZmlsZW5hbWUpXSlcbiAgICAgIH0pLnRvVGhyb3coJ21lc3NhZ2VzWzFdLmxvY2F0aW9uLmZpbGUgZG9lcyBub3QgbWF0Y2ggdGhlIGdpdmVuIGZpbGVQYXRoJylcbiAgICAgIGV4cGVjdChmdW5jdGlvbigpIHtcbiAgICAgICAgaW5kaWVEZWxlZ2F0ZS5zZXRNZXNzYWdlcyhfX2ZpbGVuYW1lLCBbZ2V0TWVzc2FnZShfX2ZpbGVuYW1lKSwgZ2V0TWVzc2FnZShfX2ZpbGVuYW1lKSwgZ2V0TWVzc2FnZSgpXSlcbiAgICAgIH0pLnRvVGhyb3coJ21lc3NhZ2VzWzJdLmxvY2F0aW9uLmZpbGUgZG9lcyBub3QgbWF0Y2ggdGhlIGdpdmVuIGZpbGVQYXRoJylcbiAgICB9KVxuICB9KVxuICBkZXNjcmliZSgnOjpjbGVhck1lc3NhZ2VzJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ2RvZXMgbm90IHVwZGF0ZSBpZiBkaXNwb3NlZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgbGV0IHRpbWVzVXBkYXRlZCA9IDBcbiAgICAgIGluZGllRGVsZWdhdGUub25EaWRVcGRhdGUoZnVuY3Rpb24oKSB7XG4gICAgICAgIHRpbWVzVXBkYXRlZCsrXG4gICAgICB9KVxuICAgICAgZXhwZWN0KHRpbWVzVXBkYXRlZCkudG9CZSgwKVxuICAgICAgaW5kaWVEZWxlZ2F0ZS5zZXRNZXNzYWdlcyhfX2ZpbGVuYW1lLCBbZ2V0TWVzc2FnZShfX2ZpbGVuYW1lKV0pXG4gICAgICBleHBlY3QodGltZXNVcGRhdGVkKS50b0JlKDEpXG4gICAgICBpbmRpZURlbGVnYXRlLmRpc3Bvc2UoKVxuICAgICAgaW5kaWVEZWxlZ2F0ZS5jbGVhck1lc3NhZ2VzKClcbiAgICAgIGV4cGVjdCh0aW1lc1VwZGF0ZWQpLnRvQmUoMSlcbiAgICB9KVxuICAgIGl0KCdkb2VzIHVwZGF0ZSBpZiBub3QgZGlzcG9zZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgIGxldCB0aW1lc1VwZGF0ZWQgPSAwXG4gICAgICBpbmRpZURlbGVnYXRlLm9uRGlkVXBkYXRlKGZ1bmN0aW9uKCkge1xuICAgICAgICB0aW1lc1VwZGF0ZWQrK1xuICAgICAgfSlcbiAgICAgIGV4cGVjdCh0aW1lc1VwZGF0ZWQpLnRvQmUoMClcbiAgICAgIGluZGllRGVsZWdhdGUuc2V0TWVzc2FnZXMoX19maWxlbmFtZSwgW2dldE1lc3NhZ2UoX19maWxlbmFtZSldKVxuICAgICAgZXhwZWN0KHRpbWVzVXBkYXRlZCkudG9CZSgxKVxuICAgICAgaW5kaWVEZWxlZ2F0ZS5jbGVhck1lc3NhZ2VzKClcbiAgICAgIGV4cGVjdCh0aW1lc1VwZGF0ZWQpLnRvQmUoMilcbiAgICB9KVxuICB9KVxuICBkZXNjcmliZSgnOjpzZXRBbGxNZXNzYWdlcycsIGZ1bmN0aW9uKCkge1xuICAgIGl0KCdhdXRvbWF0aWNhbGx5IHNwbGl0cyBtZXNzYWdlcyBpbnRvIGZpbGVQYXRoIGdyb3VwcycsIGZ1bmN0aW9uKCkge1xuICAgICAgY29uc3QgbWVzc2FnZUEgPSBnZXRNZXNzYWdlKClcbiAgICAgIGNvbnN0IG1lc3NhZ2VCID0gZ2V0TWVzc2FnZSgpXG4gICAgICBjb25zdCBtZXNzYWdlQyA9IGdldE1lc3NhZ2UoKVxuICAgICAgY29uc3QgbWVzc2FnZUQgPSBnZXRNZXNzYWdlKClcblxuICAgICAgbWVzc2FnZUMubG9jYXRpb24uZmlsZSA9IG1lc3NhZ2VELmxvY2F0aW9uLmZpbGUgPSBfX2ZpbGVuYW1lXG4gICAgICBleHBlY3QoaW5kaWVEZWxlZ2F0ZS5tZXNzYWdlcy5zaXplKS50b0JlKDApXG4gICAgICBpbmRpZURlbGVnYXRlLnNldEFsbE1lc3NhZ2VzKFttZXNzYWdlQSwgbWVzc2FnZUIsIG1lc3NhZ2VDLCBtZXNzYWdlRF0pXG4gICAgICBleHBlY3QoaW5kaWVEZWxlZ2F0ZS5tZXNzYWdlcy5zaXplKS50b0JlKDIpXG5cbiAgICAgIGNvbnN0IG1lc3NhZ2VzQSA9IGluZGllRGVsZWdhdGUubWVzc2FnZXMuZ2V0KG1lc3NhZ2VBLmxvY2F0aW9uLmZpbGUpXG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShtZXNzYWdlc0EpKS50b0JlKHRydWUpXG4gICAgICBleHBlY3QobWVzc2FnZXNBKS50b0VxdWFsKFttZXNzYWdlQSwgbWVzc2FnZUJdKVxuXG4gICAgICBjb25zdCBtZXNzYWdlc0IgPSBpbmRpZURlbGVnYXRlLm1lc3NhZ2VzLmdldChtZXNzYWdlQy5sb2NhdGlvbi5maWxlKVxuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkobWVzc2FnZXNCKSkudG9CZSh0cnVlKVxuICAgICAgZXhwZWN0KG1lc3NhZ2VzQikudG9FcXVhbChbbWVzc2FnZUMsIG1lc3NhZ2VEXSlcbiAgICB9KVxuICAgIGl0KCdkb2VzIG5vdCB1cGRhdGUgaWYgZGlzcG9zZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgIGxldCB0aW1lc1VwZGF0ZWQgPSAwXG4gICAgICBpbmRpZURlbGVnYXRlLm9uRGlkVXBkYXRlKGZ1bmN0aW9uKCkge1xuICAgICAgICB0aW1lc1VwZGF0ZWQrK1xuICAgICAgfSlcbiAgICAgIGV4cGVjdCh0aW1lc1VwZGF0ZWQpLnRvQmUoMClcbiAgICAgIGluZGllRGVsZWdhdGUuc2V0QWxsTWVzc2FnZXMoW2dldE1lc3NhZ2UoKV0pXG4gICAgICBleHBlY3QodGltZXNVcGRhdGVkKS50b0JlKDEpXG4gICAgICBpbmRpZURlbGVnYXRlLmRpc3Bvc2UoKVxuICAgICAgaW5kaWVEZWxlZ2F0ZS5zZXRBbGxNZXNzYWdlcyhbXSlcbiAgICAgIGV4cGVjdCh0aW1lc1VwZGF0ZWQpLnRvQmUoMSlcbiAgICB9KVxuICAgIGl0KCdkb2VzIHVwZGF0ZSBpZiBub3QgZGlzcG9zZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgIGxldCB0aW1lc1VwZGF0ZWQgPSAwXG4gICAgICBpbmRpZURlbGVnYXRlLm9uRGlkVXBkYXRlKGZ1bmN0aW9uKCkge1xuICAgICAgICB0aW1lc1VwZGF0ZWQrK1xuICAgICAgfSlcbiAgICAgIGV4cGVjdCh0aW1lc1VwZGF0ZWQpLnRvQmUoMClcbiAgICAgIGluZGllRGVsZWdhdGUuc2V0QWxsTWVzc2FnZXMoW2dldE1lc3NhZ2UoKV0pXG4gICAgICBleHBlY3QodGltZXNVcGRhdGVkKS50b0JlKDEpXG4gICAgICBpbmRpZURlbGVnYXRlLnNldEFsbE1lc3NhZ2VzKFtdKVxuICAgICAgZXhwZWN0KHRpbWVzVXBkYXRlZCkudG9CZSgyKVxuICAgIH0pXG4gIH0pXG4gIGRlc2NyaWJlKCc6OmRpc3Bvc2UnLCBmdW5jdGlvbigpIHtcbiAgICBpdCgnY2xlYXJzIG1lc3NhZ2VzJywgZnVuY3Rpb24oKSB7XG4gICAgICBpbmRpZURlbGVnYXRlLnNldEFsbE1lc3NhZ2VzKFtnZXRNZXNzYWdlKCldKVxuICAgICAgZXhwZWN0KGluZGllRGVsZWdhdGUubWVzc2FnZXMuc2l6ZSkudG9CZSgxKVxuICAgICAgaW5kaWVEZWxlZ2F0ZS5kaXNwb3NlKClcbiAgICAgIGV4cGVjdChpbmRpZURlbGVnYXRlLm1lc3NhZ2VzLnNpemUpLnRvQmUoMClcbiAgICB9KVxuICAgIGl0KCdlbWl0cyBkaWQtZGVzdHJveSBldmVudCcsIGZ1bmN0aW9uKCkge1xuICAgICAgbGV0IGRpZERlc3Ryb3kgPSBmYWxzZVxuICAgICAgaW5kaWVEZWxlZ2F0ZS5vbkRpZERlc3Ryb3koZnVuY3Rpb24oKSB7XG4gICAgICAgIGRpZERlc3Ryb3kgPSB0cnVlXG4gICAgICB9KVxuICAgICAgZXhwZWN0KGRpZERlc3Ryb3kpLnRvQmUoZmFsc2UpXG4gICAgICBpbmRpZURlbGVnYXRlLmRpc3Bvc2UoKVxuICAgICAgZXhwZWN0KGRpZERlc3Ryb3kpLnRvQmUodHJ1ZSlcbiAgICB9KVxuICB9KVxufSlcbiJdfQ==