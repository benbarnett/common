Object.defineProperty(exports, '__esModule', {
	value: true
});
/** @babel */

var init = function init() {
	var editor = atom.workspace.getActiveTextEditor();
	if (!editor) {
		return;
	}
	var buffer = editor.getBuffer();
	if (typeof buffer.editorconfig === 'undefined') {
		return;
	}

	var settings = buffer.editorconfig.settings;
	var softTabs = settings.indent_style === 'space';
	var checkpoint = buffer.createCheckpoint();
	var fixedProperties = {
		endOfLine: 0,
		indentStyle: 0
	};

	// fix end_of_line, if necessary
	if (settings.end_of_line !== 'auto') {
		var lastRow = buffer.getLastRow();
		for (var i = 0; i < lastRow; i++) {
			if (buffer.lineEndingForRow(i) !== settings.end_of_line && buffer.lineEndingForRow(i) !== '') {
				buffer.setTextInRange([[i, buffer.lineLengthForRow(i)], [i + 1, 0]], settings.end_of_line, { normalizeLineEndings: false });
				fixedProperties.endOfLine++;
			}
		}
	}

	// fix indent_style, if necessary
	if (settings.indent_style !== 'auto') {
		(function () {
			var spaceChar = { 'true': ' ', 'false': '\\t' };
			var tabLength = editor.getTabLength();
			// Match only malformed (containing at least one wrong tab-char) lines
			var searchPattern = '^([' + spaceChar[softTabs] + ']*[' + spaceChar[!softTabs] + ']\\s*)';

			if (tabLength > 0) {
				buffer.backwardsScan(new RegExp(searchPattern, 'gm'), function (scan) {
					var columns = scan.matchText.split('').reduce(function (prev, curr) {
						fixedProperties.indentStyle += 1;

						if (curr === ' ') {
							return prev + 1;
						}
						return prev + tabLength - prev % tabLength;
					}, 0);

					Math.max(columns, Math.floor(columns / tabLength));
					if (softTabs === true) {
						scan.replace(' '.repeat(columns));
					} else {
						var tabString = '\t'.repeat(Math.floor(columns / tabLength));
						var remainingSpaces = ' '.repeat(columns % tabLength);
						scan.replace(tabString.concat(remainingSpaces));
					}
				});
			}
		})();
	}

	if (softTabs) {
		fixedProperties.indentStyle = Math.floor(fixedProperties.indentStyle / editor.getTabLength());
	}
	var changesInTotal = 0;
	Object.keys(fixedProperties).forEach(function (k) {
		changesInTotal += fixedProperties[k];
	});

	// Prepare notification & save changes
	var notificationOptions = { dismissable: true };
	if (changesInTotal > 0) {
		var styleName = softTabs === true ? 'Tab(s)' : 'Space(s)';

		buffer.groupChangesSinceCheckpoint(checkpoint);
		notificationOptions.description = '\n|Fixed EditorConfig-Properties||\n|--------|------:|\n|`end_of_line`|' + fixedProperties.endOfLine + '|\n|`indent_style`|' + fixedProperties.indentStyle + ' ' + styleName + '|\n|Changes in total|**' + changesInTotal + '**|\n';
	} else {
		notificationOptions.description = '\nThe file ' + editor.getTitle() + ' conformed to the `end_of_line` and `indent_style` properties.\nNo changes were applied.\n';
	}
	atom.notifications.addSuccess(editor.getTitle(), notificationOptions);
};

var subscriber = function subscriber() {
	atom.commands.add('atom-workspace', 'EditorConfig:fix-file', init);
};

exports['default'] = subscriber;
exports.init = init;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9iZW5iYXJuZXR0Ly5hdG9tL3BhY2thZ2VzL2VkaXRvcmNvbmZpZy9jb21tYW5kcy9maXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFQSxJQUFNLElBQUksR0FBRyxTQUFQLElBQUksR0FBUztBQUNsQixLQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixFQUFFLENBQUM7QUFDcEQsS0FBSSxDQUFDLE1BQU0sRUFBRTtBQUNaLFNBQU87RUFDUDtBQUNELEtBQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztBQUNsQyxLQUFJLE9BQU8sTUFBTSxDQUFDLFlBQVksS0FBSyxXQUFXLEVBQUU7QUFDL0MsU0FBTztFQUNQOztBQUVELEtBQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDO0FBQzlDLEtBQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxZQUFZLEtBQUssT0FBTyxDQUFDO0FBQ25ELEtBQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0FBQzdDLEtBQU0sZUFBZSxHQUFHO0FBQ3ZCLFdBQVMsRUFBRSxDQUFDO0FBQ1osYUFBVyxFQUFFLENBQUM7RUFDZCxDQUFDOzs7QUFHRixLQUFJLFFBQVEsQ0FBQyxXQUFXLEtBQUssTUFBTSxFQUFFO0FBQ3BDLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUNwQyxPQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQ2pDLE9BQUksTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxLQUFLLFFBQVEsQ0FBQyxXQUFXLElBQ3RELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7QUFDbkMsVUFBTSxDQUFDLGNBQWMsQ0FDcEIsQ0FDQyxDQUFDLENBQUMsRUFB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LENBQUMsV0FBVyxTQUFJLFNBQVMsK0JBQ3RDLGNBQWMsVUFDbkMsQ0FBQztFQUNBLE1BQU07QUFDTixxQkFBbUIsQ0FBQyxXQUFXLG1CQUN0QixNQUFNLENBQUMsUUFBUSxFQUFFLCtGQUUzQixDQUFDO0VBQ0E7QUFDRCxLQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztDQUN0RSxDQUFDOztBQUVGLElBQU0sVUFBVSxHQUFHLFNBQWIsVUFBVSxHQUFTO0FBQ3hCLEtBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLHVCQUF1QixFQUFFLElBQUksQ0FBQyxDQUFDO0NBQ25FLENBQUM7O3FCQUVNLFVBQVU7UUFBYSxJQUFJLEdBQUosSUFBSSIsImZpbGUiOiIvVXNlcnMvYmVuYmFybmV0dC8uYXRvbS9wYWNrYWdlcy9lZGl0b3Jjb25maWcvY29tbWFuZHMvZml4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIEBiYWJlbCAqL1xuXG5jb25zdCBpbml0ID0gKCkgPT4ge1xuXHRjb25zdCBlZGl0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKCk7XG5cdGlmICghZWRpdG9yKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cdGNvbnN0IGJ1ZmZlciA9IGVkaXRvci5nZXRCdWZmZXIoKTtcblx0aWYgKHR5cGVvZiBidWZmZXIuZWRpdG9yY29uZmlnID09PSAndW5kZWZpbmVkJykge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGNvbnN0IHNldHRpbmdzID0gYnVmZmVyLmVkaXRvcmNvbmZpZy5zZXR0aW5ncztcblx0Y29uc3Qgc29mdFRhYnMgPSBzZXR0aW5ncy5pbmRlbnRfc3R5bGUgPT09ICdzcGFjZSc7XG5cdGNvbnN0IGNoZWNrcG9pbnQgPSBidWZmZXIuY3JlYXRlQ2hlY2twb2ludCgpO1xuXHRjb25zdCBmaXhlZFByb3BlcnRpZXMgPSB7XG5cdFx0ZW5kT2ZMaW5lOiAwLFxuXHRcdGluZGVudFN0eWxlOiAwXG5cdH07XG5cblx0Ly8gZml4IGVuZF9vZl9saW5lLCBpZiBuZWNlc3Nhcnlcblx0aWYgKHNldHRpbmdzLmVuZF9vZl9saW5lICE9PSAnYXV0bycpIHtcblx0XHRjb25zdCBsYXN0Um93ID0gYnVmZmVyLmdldExhc3RSb3coKTtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGxhc3RSb3c7IGkrKykge1xuXHRcdFx0aWYgKGJ1ZmZlci5saW5lRW5kaW5nRm9yUm93KGkpICE9PSBzZXR0aW5ncy5lbmRfb2ZfbGluZSAmJlxuXHRcdFx0XHRidWZmZXIubGluZUVuZGluZ0ZvclJvdyhpKSAhPT0gJycpIHtcblx0XHRcdFx0YnVmZmVyLnNldFRleHRJblJhbmdlKFxuXHRcdFx0XHRcdFtcblx0XHRcdFx0XHRcdFtpLCBidWZmZXIubGluZUxlbmd0aEZvclJvdyhpKV0sXG5cdFx0XHRcdFx0XHRbaSArIDEsIDBdXG5cdFx0XHRcdFx0XSxcblx0XHRcdFx0XHRzZXR0aW5ncy5lbmRfb2ZfbGluZSxcblx0XHRcdFx0XHR7bm9ybWFsaXplTGluZUVuZGluZ3M6IGZhbHNlfVxuXHRcdFx0XHQpO1xuXHRcdFx0XHRmaXhlZFByb3BlcnRpZXMuZW5kT2ZMaW5lKys7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly8gZml4IGluZGVudF9zdHlsZSwgaWYgbmVjZXNzYXJ5XG5cdGlmIChzZXR0aW5ncy5pbmRlbnRfc3R5bGUgIT09ICdhdXRvJykge1xuXHRcdGNvbnN0IHNwYWNlQ2hhciA9IHt0cnVlOiAnICcsIGZhbHNlOiAnXFxcXHQnfTtcblx0XHRjb25zdCB0YWJMZW5ndGggPSBlZGl0b3IuZ2V0VGFiTGVuZ3RoKCk7XG5cdFx0Ly8gTWF0Y2ggb25seSBtYWxmb3JtZWQgKGNvbnRhaW5pbmcgYXQgbGVhc3Qgb25lIHdyb25nIHRhYi1jaGFyKSBsaW5lc1xuXHRcdGNvbnN0IHNlYXJjaFBhdHRlcm4gPSBgXihbJHtzcGFjZUNoYXJbc29mdFRhYnNdfV0qWyR7c3BhY2VDaGFyWyFzb2Z0VGFic119XVxcXFxzKilgO1xuXG5cdFx0aWYgKHRhYkxlbmd0aCA+IDApIHtcblx0XHRcdGJ1ZmZlci5iYWNrd2FyZHNTY2FuKG5ldyBSZWdFeHAoc2VhcmNoUGF0dGVybiwgJ2dtJyksIHNjYW4gPT4ge1xuXHRcdFx0XHRjb25zdCBjb2x1bW5zID0gc2Nhbi5tYXRjaFRleHQuc3BsaXQoJycpLnJlZHVjZSgocHJldiwgY3VycikgPT4ge1xuXHRcdFx0XHRcdGZpeGVkUHJvcGVydGllcy5pbmRlbnRTdHlsZSArPSAxO1xuXG5cdFx0XHRcdFx0aWYgKGN1cnIgPT09ICcgJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHByZXYgKyAxO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcHJldiArIHRhYkxlbmd0aCAtIChwcmV2ICUgdGFiTGVuZ3RoKTtcblx0XHRcdFx0fSwgMCk7XG5cblx0XHRcdFx0TWF0aC5tYXgoXG5cdFx0XHRcdFx0Y29sdW1ucywgTWF0aC5mbG9vcihjb2x1bW5zIC8gdGFiTGVuZ3RoKVxuXHRcdFx0XHQpO1xuXHRcdFx0XHRpZiAoc29mdFRhYnMgPT09IHRydWUpIHtcblx0XHRcdFx0XHRzY2FuLnJlcGxhY2UoJyAnLnJlcGVhdChjb2x1bW5zKSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc3QgdGFiU3RyaW5nID0gJ1xcdCcucmVwZWF0KE1hdGguZmxvb3IoY29sdW1ucyAvIHRhYkxlbmd0aCkpO1xuXHRcdFx0XHRcdGNvbnN0IHJlbWFpbmluZ1NwYWNlcyA9ICcgJy5yZXBlYXQoY29sdW1ucyAlIHRhYkxlbmd0aCk7XG5cdFx0XHRcdFx0c2Nhbi5yZXBsYWNlKHRhYlN0cmluZy5jb25jYXQocmVtYWluaW5nU3BhY2VzKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdGlmIChzb2Z0VGFicykge1xuXHRcdGZpeGVkUHJvcGVydGllcy5pbmRlbnRTdHlsZSA9IE1hdGguZmxvb3IoXG5cdFx0XHRmaXhlZFByb3BlcnRpZXMuaW5kZW50U3R5bGUgLyBlZGl0b3IuZ2V0VGFiTGVuZ3RoKClcblx0XHQpO1xuXHR9XG5cdGxldCBjaGFuZ2VzSW5Ub3RhbCA9IDA7XG5cdE9iamVjdC5rZXlzKGZpeGVkUHJvcGVydGllcykuZm9yRWFjaChrID0+IHtcblx0XHRjaGFuZ2VzSW5Ub3RhbCArPSBmaXhlZFByb3BlcnRpZXNba107XG5cdH0pO1xuXG5cdC8vIFByZXBhcmUgbm90aWZpY2F0aW9uICYgc2F2ZSBjaGFuZ2VzXG5cdGNvbnN0IG5vdGlmaWNhdGlvbk9wdGlvbnMgPSB7ZGlzbWlzc2FibGU6IHRydWV9O1xuXHRpZiAoY2hhbmdlc0luVG90YWwgPiAwKSB7XG5cdFx0Y29uc3Qgc3R5bGVOYW1lID0gc29mdFRhYnMgPT09IHRydWUgPyAnVGFiKHMpJyA6ICdTcGFjZShzKSc7XG5cblx0XHRidWZmZXIuZ3JvdXBDaGFuZ2VzU2luY2VDaGVja3BvaW50KGNoZWNrcG9pbnQpO1xuXHRcdG5vdGlmaWNhdGlvbk9wdGlvbnMuZGVzY3JpcHRpb24gPSBgXG58Rml4ZWQgRWRpdG9yQ29uZmlnLVByb3BlcnRpZXN8fFxufC0tLS0tLS0tfC0tLS0tLTp8XG58XFxgZW5kX29mX2xpbmVcXGB8JHtmaXhlZFByb3BlcnRpZXMuZW5kT2ZMaW5lfXxcbnxcXGBpbmRlbnRfc3R5bGVcXGB8JHtmaXhlZFByb3BlcnRpZXMuaW5kZW50U3R5bGV9ICR7c3R5bGVOYW1lfXxcbnxDaGFuZ2VzIGluIHRvdGFsfCoqJHtjaGFuZ2VzSW5Ub3RhbH0qKnxcbmA7XG5cdH0gZWxzZSB7XG5cdFx0bm90aWZpY2F0aW9uT3B0aW9ucy5kZXNjcmlwdGlvbiA9IGBcblRoZSBmaWxlICR7ZWRpdG9yLmdldFRpdGxlKCl9IGNvbmZvcm1lZCB0byB0aGUgXFxgZW5kX29mX2xpbmVcXGAgYW5kIFxcYGluZGVudF9zdHlsZVxcYCBwcm9wZXJ0aWVzLlxuTm8gY2hhbmdlcyB3ZXJlIGFwcGxpZWQuXG5gO1xuXHR9XG5cdGF0b20ubm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKGVkaXRvci5nZXRUaXRsZSgpLCBub3RpZmljYXRpb25PcHRpb25zKTtcbn07XG5cbmNvbnN0IHN1YnNjcmliZXIgPSAoKSA9PiB7XG5cdGF0b20uY29tbWFuZHMuYWRkKCdhdG9tLXdvcmtzcGFjZScsICdFZGl0b3JDb25maWc6Zml4LWZpbGUnLCBpbml0KTtcbn07XG5cbmV4cG9ydCB7c3Vic2NyaWJlciBhcyBkZWZhdWx0LCBpbml0fTtcbiJdfQ==